<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/header :: headerFragment}">
    <title>청주시 상권 분석 커뮤니티</title>
</head>

<body>

<div class="main-page-container">

    <div class="board-section">
        <h1>창업 Q&A</h1>
        
        <a th:href="@{/board/post}" class="new-post-btn" sec:authorize="isAuthenticated()">
            새 글 작성하기
        </a>

        <table class="board-table">
            <thead>
                <tr>
                    <th class="post-id">번호</th>
                    <th class="post-title">제목</th>
                    <th class="post-author">작성자</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="post : ${posts}">
                    <td class="post-id" th:text="${post.id}">1</td>
                    <td class="post-title">
                        <a th:href="@{/board/detail/{id}(id=${post.id})}" th:text="${post.title}">
                            게시글 제목입니다.
                        </a>
                    </td>
                    <td class="post-author" th:text="${post.author}">김사장</td>
                </tr>
                
                <tr th:if="${#lists.isEmpty(posts)}">
                    <td colspan="3" style="text-align: center; padding: 20px;">
                        등록된 게시글이 없습니다.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="analysis-form-section">
        <div class="form-container">

            <div class="auth-section">
                <div sec:authorize="isAnonymous()">
                    <a th:href="@{/user/login}">로그인</a> | 
                    <a th:href="@{/user/signup}">회원가입</a>
                </div>
                <div sec:authorize="isAuthenticated()">
                    <span><strong th:text="${#authentication.name}"></strong>님 환영합니다!</span>
                    <a th:href="@{/user/logout}" class="logout-link">(로그아웃)</a>
                    <a th:href="@{/user/mypage}" class="mypage-link">마이페이지</a>
                </div>
            </div>

            <h1>상권 분석 시작하기</h1>
            
            <form method="post" action="/analyze" id="analysis-form">
                <label for="region">분석할 지역을 선택하세요:</label>
                <select name="region" id="region" required>
                    <option value="" disabled selected>읍/면/동 선택</option>
                    <option value="오창읍">오창읍</option>
                    <option value="복대동">복대동</option>
                    <option value="용암1동">용암1동</option>
                    <option value="율량사천동">율량사천동</option>
                    <option value="성안동">성안동</option>
                    </select>
                
                <label for="category">관심 업종을 선택하세요:</label>
                <select name="category" id="category" required>
                    <option value="" disabled selected>업종 선택</option>
                    <option value="T&E/문화">T&E/문화</option>
                    <option value="생활/음식">생활/음식</option>
                    <option value="쇼핑/유흥">쇼핑/유흥</option>
                    <option value="내구재/기타">내구재/기타</option>
                </select>
                
                <button type="submit">분석하기</button>
                <div class="error" id="form-error-message" style="display: none;"></div>
            </form>

            <div class="info-text">
                청주시정연구원의 소비패턴 데이터와<br>
                다양한 공공데이터를 기반으로<br>
                AI가 최적의 상권 정보를 분석해 드립니다.
            </div>
        </div>
    </div>

</div> <script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('analysis-form');
        const formErrorMessage = document.getElementById('form-error-message');

        if(form) {
            form.addEventListener('submit', function(event) {
                const regionSelect = document.getElementById('region');
                const categorySelect = document.getElementById('category');

                let isValid = true;
                let errorMessage = '';

                if (regionSelect.value === "") {
                    isValid = false;
                    errorMessage = "분석할 지역을 선택해주세요!";
                } else if (categorySelect.value === "") {
                    isValid = false;
                    errorMessage = "관심 업종을 선택해주세요!";
                }

                if (!isValid) {
                    event.preventDefault();
                    formErrorMessage.style.display = "block";
                    formErrorMessage.textContent = errorMessage;
                } else {
                    formErrorMessage.style.display = "none";
                    // (분석 기능은 아직 구현되지 않았으므로 임시로 막음)
                    event.preventDefault(); 
                    alert("'" + regionSelect.value + "' 지역의 '" + categorySelect.value + "' 업종 분석 기능은 준비 중입니다.");
                }
            });
        }
    });
</script>

</body>
</html>